<!DOCTYPE html>
<html>

<head>
    <title>360VR Educator Database</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="http://code.jquery.com/jquery.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body onload="disableSubmit()" style="background-color: rgb(50,50,72);">
    <br />
    <div class="container">
        <h3 align="center" style="color: rgb(255,255,255);">
            < Upload to 360VR Educator Database>
        </h3>
        <br />
        <div class="panel panel-default" style="background-color:rgb(0, 0, 0);border: rgb(0, 0, 0);">
            <div class="panel-heading"
                style="background-color:rgb(82, 82, 152);color: rgb(255, 255, 255); border: rgb(0, 0, 0);">
                <h3 class="panel-title">Generate weblink for a file to use it in 360VR Educator</h3>
                <button style="background-color: rgb(71, 76, 87) ; border-color: rgb(71, 76, 87) ; color: #f0f0f0;float: right; -ms-transform: translate(-50%, -50%);
  transform: translate(4%, -75%); margin-left :10px" onclick="window.open('./Database','_self')">Browse Database</button>
                <button style="background-color: rgb(71, 76, 87) ; border-color: rgb(71, 76, 87) ; color: #f0f0f0;float: right; -ms-transform: translate(-50%, -50%);
  transform: translate(4%, -75%); margin-left :10px" onclick="window.open('../','_self')">Dashboard</button>
            </div>
            <div class="panel-body" style="background-color: rgb(82,82,92); color: rgb(255, 255, 255);">
                <form method="POST" enctype="multipart/form-data" action="backend.php">
                    Select item to upload:<br>
                    <!-- <label for="profile_photo" class="btn btn-primary btn-outlined" style="background-color:rgb(102,102,122); border: rgb(0,0,0); height: 9rem; text-align: center; font-size: 5rem;">Drag and drop a file here!</label> -->
                    Choose from your device or drag drop on the button below
                    <input id="fileupload" type="file" name="fileupload"
                        onchange="filenametoset.value=fileupload.files[0].name.replace(/\s+/g, '_');" />

                </form>
                Save file as (Including File Extention):
                <br>
                <input id="filenametoset" type="text" name="filenametoset"
                    style="width:28rem; color:rgb(0,0,0);background-color:rgb(163, 166, 173);border: rgba(0,0,0,0);" />
                <br>
                <br>
                The Work / Contents / Materials will be created in this platform is made available<br> under a <a
                    href="http://creativecommons.org/licenses">Creative Commons Attribution-Share Alike 4.0
                    License</a>(International) by CEMCA.
                <br>
                <input type="checkbox" name="terms" id="terms" onchange="activateButton(this)" checked> I Agree to the
                above Terms & Coditions
                <br>
                <button id="fileuploadbutton" class="submit btn btn-success btn-lg d-block mx-auto" align="center"
                    type="submit" onclick="savefile()">Upload Selected File</button>
                <p id="prevfilename"></p>
            </div>
        </div>
    </div>
    <br />

    <br />



    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Success!</h2>
            </div>
            <div id="poptext" class="modal-body">
                <p>No File yet Checked</p>
            </div>
            <div class="modal-footer">
                <button class="copybutton" onclick=""> Copy To Clipboard </button>
            </div>
        </div>

    </div>
    <script>
        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the button that opens the modal
        // var btn = document.getElementById("myBtn");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

// When the user clicks anywhere outside of the modal, close it
// window.onclick = function(event) {
//   if (event.target == modal) {
//     modal.style.display = "none";
//   }
// }
    </script>
    <script>
        async function savefile() {
            let formData = new FormData();
            formData.append("file", fileupload.files[0], filenametoset.value.replace(/\s+/g, '_'));
            await fetch('/uploadphp.php', { method: "POST", body: formData });

            let fileURL = "http://103.65.20.143:8888" + "/ARDatabase/" + formData.get("file").name;
            // alert(
            //   "The file has successfully been uploaded to the server."
            //   + "\nURL for your file :\n\n\n"
            //   + fileURL 
            //   + "\nhas been copied to the clipboard"
            //   );
            modal.style.display = "block";
            document.getElementById("poptext").innerHTML = "The file has successfully been uploaded to the server.<br>Kindly use the generated URL in 360VR Eduator to use the file.<br>URL for your file :<br><br><br>" + fileURL;
            let s = "";
            if (document.getElementById("prevfilename").innerHTML === "") s += "<br>Previous Files:";
            s += "<br>" + fileURL;
            document.getElementById("prevfilename").innerHTML += s;
        }
    </script>
    <script>
        function disableSubmit() {
            document.getElementById("fileuploadbutton").disabled = !terms.checked;
            //document.getElementById("fileuploadbutton").disabled = true;
        }

        function activateButton(element) {
            document.getElementById("fileuploadbutton").disabled = !element.checked;
        }
        let details = navigator.userAgent, regexp = /android|iphone|kindle|ipad/i;
        let isMobileDevice = regexp.test(details);
        if (!isMobileDevice) {
            document.body.style.zoom = 1.5;
        }
    </script>
</body>

</html>